<div class="alerts">
  <header class="alerts__header">
    <div>
      <h2>Alertas de stock</h2>
      <p>Monitorea el estado de tus productos críticos en tiempo real.</p>
    </div>
  </header>

  <ng-container *ngIf="alerts$ | async as vm">
    <section class="alerts__summary">
      <article class="summary-card">
        <span class="material-symbols-outlined">priority_high</span>
        <div>
          <h3>Resumen de alertas</h3>
          <p>
            {{ vm.criticalCount > 0
              ? vm.criticalCount + ' productos requieren reposición'
              : 'No hay productos en nivel crítico' }}
          </p>
        </div>
      </article>
    </section>

    <section class="alerts__list">
      <h3>Detalle por producto</h3>
      <article class="empty" *ngIf="!vm.ordered.length">
        <span class="material-symbols-outlined">inventory_2</span>
        <p>Aún no hay productos registrados en inventario o cosechas.</p>
      </article>

      <ul *ngIf="vm.ordered.length">
        <li *ngFor="let item of vm.ordered; trackBy: trackById" [class.critical]="item.critical">
          <div class="item__icon" [class.critical]="item.critical">
            <span class="material-symbols-outlined">{{ item.icon }}</span>
          </div>
          <div class="item__body">
            <strong>{{ item.name }}</strong>
            <span>{{ item.quantity | quantityFormat }} unidades disponibles</span>
            <small>{{ item.category }}</small>
            <small>Fuente: {{ item.source === 'inventario' ? 'Inventario' : 'Cosecha' }}</small>
            <small *ngIf="item.date">Registrado: {{ item.date | date:'mediumDate' }}</small>
          </div>
          <span class="badge" [class.badge__critical]="item.critical" [class.badge__safe]="!item.critical">
            {{ item.critical ? 'Crítico' : 'Saludable' }}
          </span>
        </li>
      </ul>
    </section>
  </ng-container>
</div>
